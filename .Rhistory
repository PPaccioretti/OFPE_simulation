,keep.data=FALSE)
setTxtProgressBar(pb, 8)
####################################################################################
####################################################################################
####################################################################################
######Diseño en BLOQUE Completamente Aleatorizado  \\  MisParcelasDBCATrat
### ANAVA NULO
#ANOVA CON EFECTO ALEATORIO FRANJA
M.DBCA.Nulo.BlA<-lme(as.formula(Formula.Nulo)
,random=list(Bloque=pdIdent(~1))
,method="REML"
,control=lmeControl(niterEM=150
,msMaxIter=200)
,na.action=na.omit
,data=MisParcelasDBCATrat
,keep.data=FALSE)
setTxtProgressBar(pb, 9)
#ANOVA CON EFECTO ALEATORIO FRANJA
M.DBCA.Nulo.Zo.BlA <-lme(as.formula(Formula.Nulo.Zo)
,random=list(Bloque=pdIdent(~1))
,method="REML"
,control=lmeControl(niterEM=150
,msMaxIter=200)
,na.action=na.omit
,data=MisParcelasDBCATrat
,keep.data=FALSE)
setTxtProgressBar(pb, 10)
#ANOVA CON EFECTO ALEATORIO FRANJA
M.DBCA.Nulo.BlA.Co<-lme(as.formula(Formula.Nulo)
,random=list(Bloque=pdIdent(~1))
,correlation=corExp(form=~as.numeric(as.character(x))+as.numeric(as.character(y))
,metric="euclidean"
,nugget=FALSE)
,method="REML"
,control=lmeControl(niterEM=150
,msMaxIter=200)
,na.action=na.omit
,data=MisParcelasDBCATrat
,keep.data=FALSE)
setTxtProgressBar(pb, 11)
#ANOVA CON EFECTO ALEATORIO FRANJA
M.DBCA.Nulo.Zo.BlA.Co <-lme(as.formula(Formula.Nulo.Zo)
,random=list(Bloque=pdIdent(~1))
,correlation=corExp(form=~as.numeric(as.character(x))+as.numeric(as.character(y))
,metric="euclidean"
,nugget=FALSE)
,method="REML"
,control=lmeControl(niterEM=150
,msMaxIter=200)
,na.action=na.omit
,data=MisParcelasDBCATrat
,keep.data=FALSE)
setTxtProgressBar(pb, 12)
##################CON RENDIMIENTO
#ANOVA CON EFECTO ALEATORIO FRANJA
M.DBCA.BlA<-lme(as.formula(Formula.Rto)
,random=list(Bloque=pdIdent(~1))
,method="REML"
,control=lmeControl(niterEM=150
,msMaxIter=200)
,na.action=na.omit
,data=MisParcelasDBCATrat
,keep.data=FALSE)
setTxtProgressBar(pb, 13)
#ANOVA CON EFECTO ALEATORIO FRANJA
M.DBCA.Zo.BlA <-lme(as.formula(Formula.Rto.Zo)
,random=list(Bloque=pdIdent(~1))
,method="REML"
,control=lmeControl(niterEM=150
,msMaxIter=200)
,na.action=na.omit
,data=MisParcelasDBCATrat
,keep.data=FALSE)
setTxtProgressBar(pb, 14)
#ANOVA CON EFECTO ALEATORIO FRANJA
M.DBCA.BlA.Co<-lme(as.formula(Formula.Rto)
,random=list(Bloque=pdIdent(~1))
,correlation=corExp(form=~as.numeric(as.character(x))+as.numeric(as.character(y))
,metric="euclidean"
,nugget=FALSE)
,method="REML"
,control=lmeControl(niterEM=150
,msMaxIter=200)
,na.action=na.omit
,data=MisParcelasDBCATrat
,keep.data=FALSE)
setTxtProgressBar(pb, 15)
#ANOVA CON EFECTO ALEATORIO FRANJA
M.DBCA.Zo.BlA.Co <-lme(as.formula(Formula.Rto.Zo)
,random=list(Bloque=pdIdent(~1))
,correlation=corExp(form=~as.numeric(as.character(x))+as.numeric(as.character(y))
,metric="euclidean"
,nugget=FALSE)
,method="REML"
,control=lmeControl(niterEM=150
,msMaxIter=200)
,na.action=na.omit
,data=MisParcelasDBCATrat
,keep.data=FALSE)
setTxtProgressBar(pb, 16)
####################################################################################
####################################################################################
####################################################################################
####################################################################################
#######Diseño Completamente Aleatorizado DCA  \\  MisParcelasDCATrat
### ANAVA NULO
### ANAVA NULO
#ANOVA = ErrorConEfecto~1+AsigTrat
M.DCA.Nulo<-lm(as.formula(Formula.Nulo)
,na.action=na.omit
,data=MisParcelasDCATrat)
setTxtProgressBar(pb, 17)
#ANOVA CON CORRELACION ESPACIAL
M.DCA.Nulo.Co<-gls(as.formula(Formula.Nulo)
,correlation=corExp(form=~as.numeric(as.character(x))+as.numeric(as.character(y))
,metric="euclidean"
,nugget=FALSE)
,method="REML"
,na.action=na.omit
,data=MisParcelasDCATrat)
setTxtProgressBar(pb, 18)
#ANOVA = ErrorConEfecto~1+AsigTrat
M.DCA.Nulo.Zo<-lm(as.formula(Formula.Nulo.Zo)
,na.action=na.omit
,data=MisParcelasDCATrat)
setTxtProgressBar(pb, 19)
#ANOVA CON CORRELACION ESPACIAL
M.DCA.Nulo.Zo.Co<-gls(as.formula(Formula.Nulo.Zo)
,correlation=corExp(form=~as.numeric(as.character(x))+as.numeric(as.character(y))
,metric="euclidean"
,nugget=FALSE)
,method="REML"
,na.action=na.omit
,data=MisParcelasDCATrat)
setTxtProgressBar(pb, 20)
##### CON RENDIMIENTO
#ANOVA = MiRto~1+AsigTrat
M.DCA<-lm(as.formula(Formula.Rto)
,na.action=na.omit
,data=MisParcelasDCATrat)
setTxtProgressBar(pb, 21)
#ANOVA CON EFECTO ALEATORIO FRANJA
M.DCA.Zo<-lm(as.formula(Formula.Rto.Zo)
,na.action=na.omit
,data=MisParcelasDCATrat)
setTxtProgressBar(pb, 22)
#ANOVA CON CORRELACION ESPACIAL
M.DCA.Co<-gls(as.formula(Formula.Rto)
,correlation=corExp(form=~as.numeric(as.character(x))+as.numeric(as.character(y))
,metric="euclidean"
,nugget=FALSE)
,method="REML"
,na.action=na.omit
,data=MisParcelasDCATrat)
setTxtProgressBar(pb, 23)
#ANOVA CON CORRELACION ESPACIAL
M.DCA.Zo.Co<-gls(as.formula(Formula.Rto.Zo)
,correlation=corExp(form=~as.numeric(as.character(x))+as.numeric(as.character(y))
,metric="euclidean"
,nugget=FALSE)
,method="REML"
,na.action=na.omit
,data=MisParcelasDCATrat)
setTxtProgressBar(pb, 24)
####################################################################################
####################################################################################
# Modelo <- M.DCA
# Modelo <- M.DCA.Co
# Modelo <- M.DCA.Zo.Co
# Modelo <- M.FR.Zo.FrA.Co
# Modelo <- M.FR.Zo.FrA
ResumirModelo <- function(Modelo) {
ModelResumen <- data.frame(
"Modelo" = deparse(substitute(Modelo)),
"rango" = as.numeric(as.character(
capture.output(Modelo$modelStruct$corStruct)[3]
)) * 3,
###################### SE MULTIPLICA POR TRES PARA PODER COMPARARLO
###################### CON EL RANGO REAL
"Akaike" = AIC(Modelo),
"SigmaError" = sigma(Modelo)
)
if (class(Modelo) == "gls") {
TablaAnava <- summary(Modelo)$tTable
colnames(TablaAnava) <-
c("Value", "Std.Error", "t-value", "p-value")
Betas <- data.frame(
"Modelo" = deparse(substitute(Modelo)),
"Coeficientes" = rownames(summary(Modelo)$tTable),
TablaAnava,
"DF" = NA,
row.names = NULL
)[, c(1:4, 7, 5:6)]
}
if (class(Modelo) == "lme") {
TablaAnava <- summary(Modelo)$tTable
colnames(TablaAnava) <-
c("Value", "Std.Error", "DF", "t-value", "p-value")
Betas <- data.frame(
"Modelo" = deparse(substitute(Modelo)),
"Coeficientes" = rownames(summary(Modelo)$tTable),
TablaAnava,
row.names = NULL
)
}
if (class(Modelo) == "lm") {
TablaAnava <- summary(Modelo)$coefficients
colnames(TablaAnava) <-
c("Value", "Std.Error", "t-value", "p-value")
Betas <- data.frame(
"Modelo" = deparse(substitute(Modelo)),
"Coeficientes" = rownames(summary(Modelo)$coefficients),
TablaAnava,
"DF" = NA,
row.names = NULL
)[, c(1:4, 7, 5:6)]
}
return(list("Resumen" = ModelResumen, "Betas" = Betas))
}
ResumenModelos <-
sapply(ls(pattern = "M[.]"), function(Es) {
eval(parse(text = paste0("ResumirModelo(", Es, ")")))
},
USE.NAMES = TRUE, simplify = FALSE)
ResumenResult <-
do.call(rbind, lapply(ResumenModelos, function(x) {
x$Resumen
}))
ResumenResult$RangoReal <- NA
ResumenResult[!is.na(ResumenResult$rango), "RangoReal"] <-
ModeloVariograma$Range
setTxtProgressBar(pb, 25)
#Betas Estimados
BetasEst <-
do.call(rbind, lapply(ResumenModelos, function(x) {
x$Betas
}))  ### INTENTAR SACARLO DE LA LISTA
BetasEst$Orden <- 1:nrow(BetasEst)
#Betas Reales
BetasReales <- data.frame(
"Coeficientes" = c("AsigTrat", "I(AsigTrat^2)", "AsigTrat:as.factor(Zona)24.6"),
"ValoresReales" = c(miBeta1, miBeta2, TerInterZonError * unique(Simulacion$Zona)[2])
)
BetasEstReal <- merge(BetasReales, BetasEst, all.y = T, sort = FALSE)
BetasEstReal <-
BetasEstReal[order(BetasEstReal$Orden), c(3, 1, 4, 2, 5:(ncol(BetasEstReal) -
1))] # Es -1 para que saque la columna Orden
setTxtProgressBar(pb, 26)
# close(pb)
return(list(
"Resumen" = ResumenResult,
"BetasEstReal" = BetasEstReal,
"Semilla" = MiSemilla
))
}
clear()
w
sapply(1:1, function(i) {
# Con 0 en los trat
## Alta variacion Tratamientos
### baja correlacion espacial "<0.25"
Test_AltaVarT_BajaCorr <-
GenerarCampoAjustarModelos(Trat = c(0, 70, 140, 210, 280),
rango = 47.11,
sill = 7.85,
nugget = 0.94)
### media correlacion espacial "0.25-0.75"
Test_AltaVarT_MediaCorr <-
GenerarCampoAjustarModelos(Trat = c(0, 70, 140, 210, 280),
rango = 56.82,
sill = 4.81,
nugget = 2.54)
## Baja variacion Tratamientos
### baja correlacion espacial "<0.25"
Test_BajaVarT_BajaCorr <-
GenerarCampoAjustarModelos(Trat = c(0, 40, 70, 100, 140),
rango = 47.11,
sill = 7.85,
nugget = 0.94)
### media correlacion espacial "0.25-0.75"
Test_BajaVarT_MediaCorr <-
GenerarCampoAjustarModelos(Trat = c(0, 40, 70, 100, 140),
rango = 56.82,
sill = 4.81,
nugget = 2.54)
# Sin 0 en los trat
## Alta variacion Tratamientos
### baja correlacion espacial "<0.25"
SinTest_AltaVarT_BajaCorr <-
GenerarCampoAjustarModelos(Trat = c(70, 140, 210, 280),
rango = 47.11,
sill = 7.85,
nugget = 0.94)
### media correlacion espacial "0.25-0.75"
SinTest_AltaVarT_MediaCorr <-
GenerarCampoAjustarModelos(Trat = c(70, 140, 210, 280),
rango = 56.82,
sill = 4.81,
nugget = 2.54)
## Baja variacion Tratamientos
### baja correlacion espacial "<0.25"
SinTest_BajaVarT_BajaCorr <-
GenerarCampoAjustarModelos(Trat = c(40, 70, 100, 140),
rango = 47.11,
sill = 7.85,
nugget = 0.94)
### media correlacion espacial "0.25-0.75"
SinTest_BajaVarT_MediaCorr <-
GenerarCampoAjustarModelos(Trat = c(40, 70, 100, 140),
rango = 56.82,
sill = 4.81,
nugget = 2.54)
browser()
})
Test_AltaVarT_BajaCorr
Test_AltaVarT_MediaCorr
Test_AltaVarT_BajaCorr
Test_AltaVarT_BajaCorr
names(Test_AltaVarT_BajaCorr)
Test_AltaVarT_BajaCorr$Resumen
Test_AltaVarT_BajaCorr$Resumen
Test_AltaVarT_BajaCorr$BetasEstReal
Test_AltaVarT_BajaCorr$BetasEstReal
Test_AltaVarT_BajaCorr
Test_AltaVarT_BajaCorr
options()
names(options())
data.frame(info_Test_AltaVarT_BajaCorr,
Test_AltaVarT_BajaCorr$Resumen)
info_Test_AltaVarT_BajaCorr <- data.frame('Dosis0' = 'Si',
'TratMax' = 280,
'CorrEsp' = 'baja')
data.frame(info_Test_AltaVarT_BajaCorr,
Test_AltaVarT_BajaCorr$Resumen)
data.frame(info_Test_AltaVarT_BajaCorr,
Test_AltaVarT_BajaCorr$BetasEstReal)
info_Test_AltaVarT_BajaCorr <- data.frame(
'Simulacion' = i,
'Dosis0' = 'Si',
'TratMax' = 280,
'CorrEsp' = 'baja')
Test_AltaVarT_BajaCorr$Resumen <-
data.frame(info_Test_AltaVarT_BajaCorr,
Test_AltaVarT_BajaCorr$Resumen)
Test_AltaVarT_BajaCorr$BetasEstReal <-
data.frame(info_Test_AltaVarT_BajaCorr,
Test_AltaVarT_BajaCorr$BetasEstReal)
info_Test_AltaVarT_MediaCorr <- data.frame(
'Simulacion' = i,
'Dosis0' = 'Si',
'TratMax' = 280,
'CorrEsp' = 'media')
Test_AltaVarT_MediaCorr$Resumen <-
data.frame(info_Test_AltaVarT_MediaCorr,
Test_AltaVarT_MediaCorr$Resumen)
Test_AltaVarT_MediaCorr$BetasEstReal <-
data.frame(info_Test_AltaVarT_MediaCorr,
Test_AltaVarT_MediaCorr$BetasEstReal)
info_Test_BajaVarT_BajaCorr <- data.frame(
'Simulacion' = i,
'Dosis0' = 'Si',
'TratMax' = 140,
'CorrEsp' = 'baja')
Test_BajaVarT_BajaCorr$Resumen <-
data.frame(info_Test_BajaVarT_BajaCorr,
Test_BajaVarT_BajaCorr$Resumen)
Test_BajaVarT_BajaCorr$BetasEstReal <-
data.frame(info_Test_BajaVarT_BajaCorr,
Test_BajaVarT_BajaCorr$BetasEstReal)
info_Test_BajaVarT_MediaCorr <- data.frame(
'Simulacion' = i,
'Dosis0' = 'Si',
'TratMax' = 140,
'CorrEsp' = 'media')
Test_BajaVarT_MediaCorr$Resumen <-
data.frame(info_Test_BajaVarT_MediaCorr,
Test_BajaVarT_MediaCorr$Resumen)
Test_BajaVarT_MediaCorr$BetasEstReal <-
data.frame(info_Test_BajaVarT_MediaCorr,
Test_BajaVarT_MediaCorr$BetasEstReal)
info_SinTest_AltaVarT_BajaCorr <- data.frame(
'Simulacion' = i,
'Dosis0' = 'No',
'TratMax' = 280,
'CorrEsp' = 'baja')
SinTest_AltaVarT_BajaCorr$Resumen <-
data.frame(info_SinTest_AltaVarT_BajaCorr,
SinTest_AltaVarT_BajaCorr$Resumen)
SinTest_AltaVarT_BajaCorr$BetasEstReal <-
data.frame(info_SinTest_AltaVarT_BajaCorr,
SinTest_AltaVarT_BajaCorr$BetasEstReal)
info_SinTest_AltaVarT_MediaCorr <- data.frame(
'Simulacion' = i,
'Dosis0' = 'No',
'TratMax' = 280,
'CorrEsp' = 'media')
SinTest_AltaVarT_MediaCorr$Resumen <-
data.frame(info_SinTest_AltaVarT_MediaCorr,
SinTest_AltaVarT_MediaCorr$Resumen)
SinTest_AltaVarT_MediaCorr$BetasEstReal <-
data.frame(info_SinTest_AltaVarT_MediaCorr,
SinTest_AltaVarT_MediaCorr$BetasEstReal)
info_SinTest_BajaVarT_BajaCorr <- data.frame(
'Simulacion' = i,
'Dosis0' = 'No',
'TratMax' = 140,
'CorrEsp' = 'baja')
SinTest_BajaVarT_BajaCorr$Resumen <-
data.frame(info_SinTest_BajaVarT_BajaCorr,
SinTest_BajaVarT_BajaCorr$Resumen)
SinTest_BajaVarT_BajaCorr$BetasEstReal <-
data.frame(info_SinTest_BajaVarT_BajaCorr,
SinTest_BajaVarT_BajaCorr$BetasEstReal)
info_SinTest_BajaVarT_MediaCorr <- data.frame(
'Simulacion' = i,
'Dosis0' = 'No',
'TratMax' = 140,
'CorrEsp' = 'media')
SinTest_BajaVarT_MediaCorr$Resumen <-
data.frame(info_SinTest_BajaVarT_MediaCorr,
SinTest_BajaVarT_MediaCorr$Resumen)
SinTest_BajaVarT_MediaCorr$BetasEstReal <-
data.frame(info_SinTest_BajaVarT_MediaCorr,
SinTest_BajaVarT_MediaCorr$BetasEstReal)
do.call(rbind, list(Test_AltaVarT_BajaCorr$Resumen,
Test_AltaVarT_MediaCorr$Resumen,
Test_BajaVarT_BajaCorr$Resumen,
Test_BajaVarT_MediaCorr$Resumen,
SinTest_AltaVarT_BajaCorr$Resumen,
SinTest_AltaVarT_MediaCorr$Resumen,
SinTest_BajaVarT_BajaCorr$Resumen,
SinTest_BajaVarT_MediaCorr$Resumen))
Test_AltaVarT_BajaCorr
semimlla <- do.call(
rbind,
list(
Test_AltaVarT_BajaCorr$Semilla,
Test_AltaVarT_MediaCorr$Semilla,
Test_BajaVarT_BajaCorr$Semilla,
Test_BajaVarT_MediaCorr$Semilla,
SinTest_AltaVarT_BajaCorr$Semilla,
SinTest_AltaVarT_MediaCorr$Semilla,
SinTest_BajaVarT_BajaCorr$Semilla,
SinTest_BajaVarT_MediaCorr$Semilla
)
)
semimlla
Test_AltaVarT_BajaCorr$Semilla
Test_AltaVarT_MediaCorr$Semilla
SinTest_BajaVarT_MediaCorr
SinTest_BajaVarT_MediaCorr
SinTest_BajaVarT_BajaCorr
SinTest_AltaVarT_MediaCorr
SinTest_BajaVarT_MediaCorr
SinTest_BajaVarT_BajaCorr
SinTest_BajaVarT_MediaCorr
SinTest_BajaVarT_BajaCorr
SinTest_AltaVarT_MediaCorr
data.frame('Simulacion' = i)
data.frame('Simulacion' = i, semimlla)
list(
'Resumen' = resumen,
'BetasEstReal' = betas,
'Semilla' = semilla)
resumen <- do.call(
rbind,
list(
Test_AltaVarT_BajaCorr$Resumen,
Test_AltaVarT_MediaCorr$Resumen,
Test_BajaVarT_BajaCorr$Resumen,
Test_BajaVarT_MediaCorr$Resumen,
SinTest_AltaVarT_BajaCorr$Resumen,
SinTest_AltaVarT_MediaCorr$Resumen,
SinTest_BajaVarT_BajaCorr$Resumen,
SinTest_BajaVarT_MediaCorr$Resumen
)
)
semilla <- do.call(
rbind,
list(
Test_AltaVarT_BajaCorr$Semilla,
Test_AltaVarT_MediaCorr$Semilla,
Test_BajaVarT_BajaCorr$Semilla,
Test_BajaVarT_MediaCorr$Semilla,
SinTest_AltaVarT_BajaCorr$Semilla,
SinTest_AltaVarT_MediaCorr$Semilla,
SinTest_BajaVarT_BajaCorr$Semilla,
SinTest_BajaVarT_MediaCorr$Semilla
)
)
betas <- do.call(
rbind,
list(
Test_AltaVarT_BajaCorr$BetasEstReal,
Test_AltaVarT_MediaCorr$BetasEstReal,
Test_BajaVarT_BajaCorr$BetasEstReal,
Test_BajaVarT_MediaCorr$BetasEstReal,
SinTest_AltaVarT_BajaCorr$BetasEstReal,
SinTest_AltaVarT_MediaCorr$BetasEstReal,
SinTest_BajaVarT_BajaCorr$BetasEstReal,
SinTest_BajaVarT_MediaCorr$BetasEstReal
)
)
semilla <- data.frame('Simulacion' = i, 'Semilla' = semilla)
list(
'Resumen' = resumen,
'BetasEstReal' = betas,
'Semilla' = semilla)
list(
'Resumen' = resumen,
'BetasEstReal' = betas,
'Semilla' = semilla)
